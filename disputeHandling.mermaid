sequenceDiagram
    actor Learner
    actor Support
    actor Tutor
    participant Frontend
    participant System
    participant Database
    participant RecordingService

    activate Learner
    activate Frontend
    Learner->>Frontend: Click on "Report Session"
    Frontend->>+System: sendDisputeRequest(sessionId)
    activate System
    System->>+Database: flagSessionAsDisputed(sessionId)
    Database-->>-System: Dispute flagged
    System-->>Frontend: Dispute registered
    Frontend-->>Learner: Dispute confirmed
    deactivate System
    deactivate Frontend

    activate Support
    activate System

    loop Dispute Resolution
        Support->>+System: Review dispute (disputeId)
        System->>+Database: Fetch dispute details (disputeId)
        Database-->>-System: Dispute information
        System-->>Support: Display dispute information
        System->>+RecordingService: Retrieve session recording (sessionId)
        RecordingService-->>-System: Session recording
        System-->>Support: Display session recording

        activate Database
        System->>+Database: Get feedback (sessionId)
        Database-->>-System: Feedback information
        deactivate Database
        System-->>Support: Display feedback
    end

    Support->>System: Resolve dispute (sessionId, decision)
    alt Resolved in favor of Tutor
        System->>+Database: Add payment to tutor wallet (userId, amount)
        activate Database
        Database-->>-System: Payment confirmed
        deactivate Database
        System->>+Database: Update session status (sessionId, status)
        activate Database
        Database-->>-System: Status updated
        deactivate Database
        activate Frontend
        System-->>Frontend: Dispute resolution status
        Frontend-->>Learner: Display dispute result
        activate Tutor
        Frontend->>Tutor: Payment added to your wallet
    else Resolved in favor of Learner
        System->>+Database: Refund learner wallet (learnerId, amount)
        activate Database
        Database-->>-System: Refund confirmed
        deactivate Database
        System->>+Database: Update session status (sessionId, "Resolved in favor of Learner")
        Database-->>System: Status updated
        System-->>Frontend: Dispute resolution status
        Frontend-->>Learner: Display dispute result
        Frontend->>Tutor: Notify dispute outcome
    end
    deactivate System
    deactivate Frontend
    deactivate Support
    deactivate Learner
    deactivate Tutor
