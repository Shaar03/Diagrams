sequenceDiagram
    actor Learner
    participant Frontend
    participant System
    participant Database
    participant PaymentGateway
    actor Tutor

    activate Learner
    Learner->>+Frontend: searchTutors()
    Frontend->>+System: getAvailableTutors()
    System->>+Database: fetchAvailableTutors()
    Database-->>-System: returnTutorList()
    System-->>-Frontend: displayTutors()
    Frontend-->>Learner: showTutorList()
    Learner->>Frontend: selectSessionAndBook(sessionId)
    Frontend->>+System: sendBookingRequest(sessionId, learnerId)
    System->>+Database: checkWalletBalance(learnerId)
    Database-->>-System: returnWalletBalance()
    alt Sufficient funds
        System->>+Database: deductFunds(learnerId, sessionCost)
        System->>Database: createBookingRecord(sessionId, learnerId, tutorId)
        Database-->>-System: confirmBooking()
        System-->>Frontend: bookingConfirmed(sessionId)
        Frontend-->>Learner: displayBookingConfirmation()
        System->>Tutor: sendBookingNotification(tutorId, sessionId)
        activate Tutor
        deactivate Tutor
    else Insufficient funds
        System-->>Frontend: insufficientFundsError()
        Frontend-->>Learner: displayErrorAndPromptForFunds()
        deactivate System
        Learner->>Frontend: chooseToAddFunds()
        Frontend->>+System: initiateAddFundsProcess(learnerId)
        System->>+PaymentGateway: requestPayment(learnerId, amount)
        alt Payment Successful
            PaymentGateway-->>-System: paymentConfirmation()
            System->>+Database: updateWalletBalance(learnerId, amount)
            Database-->>-System: confirmBalanceUpdate()
            System-->>Frontend: fundsAddedSuccessfully()
            Frontend-->>Learner: displayUpdatedBalance()
            Note over Frontend: Automatically retry booking
            Frontend->>System: sendBookingRequest(sessionId, learnerId)
        else Payment Unsuccessful
            PaymentGateway-->>System: paymentFailureNotification()
            System-->>Frontend: paymentFailed()
            Frontend-->>Learner: displayPaymentFailure()
        end
    end
    deactivate Frontend
    deactivate Learner
