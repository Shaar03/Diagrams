sequenceDiagram
    actor Learner
    participant Frontend
    participant System
    participant Database
    participant PaymentGateway
    actor Tutor

    activate Learner
    Learner->>+Frontend: Search for tutors
    Frontend->>+System: Request available tutors
    System->>+Database: Fetch available tutors
    Database-->>-System: Return tutor list
    System-->>-Frontend: Display tutor list
    Frontend-->>Learner: Show tutor list
    Learner->>Frontend: Select session and click "Book"
    Frontend->>+System: Send booking request
    System->>+Database: Check learner's wallet balance
    Database-->>-System: Return wallet balance
    alt Sufficient funds
        System->>+Database: Deduct session cost from wallet
        System->>Database: Create booking record
        Database-->>-System: Confirm booking
        System-->>Frontend: Booking confirmed
        Frontend-->>Learner: Display booking confirmation
        System->>Tutor: Send booking notification
        activate Tutor
        deactivate Tutor
    else Insufficient funds
        System-->>Frontend: Insufficient funds error
        Frontend-->>Learner: Display error and prompt to add funds
        deactivate System
        Learner->>Frontend: Choose to add funds
        Frontend->>+System: Initiate add funds process
        System->>+PaymentGateway: Request payment
        alt Payment Successful
            PaymentGateway-->>-System: Payment confirmation
            System->>+Database: Update wallet balance
            Database-->>-System: Confirm balance update
            System-->>Frontend: Funds added successfully
            Frontend-->>Learner: Display updated balance
            Note over Frontend: Automatically retry booking
            Frontend->>System: Send booking request
        else Payment Unsuccessful
            PaymentGateway-->>System: Payment failure notification
            System-->>Frontend: Payment failed
            Frontend-->>Learner: Display payment failure
        end
    end
    deactivate Frontend
    deactivate Learner